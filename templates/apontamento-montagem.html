{% extends 'sidebar.html' %}

{% block title %}
<title>Apontamento Montagem</title>
{% endblock %}

{% block links %}
<!-- Custom styles for this page -->
<link rel="stylesheet" type="text/css"
    href="{{ url_for('static',filename='vendor/datatables/dataTables.bootstrap4.min.css') }}">
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css" />

<!-- CSS tables responsive -->
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/no-more-table.css') }}">

<style>
    /* Adicione algum estilo para o ícone "x" dentro do campo */
    .clear-icon-operador {
        cursor: pointer;
        position: absolute;
        right: 15px;
        top: 24%;
        z-index: 999;
        /* Certifica-se de que está sobre outros elementos */
        background-color: red;
        color: white;
        width: 20px;
        /* Ajuste o tamanho conforme necessário */
        height: 20px;
        /* Ajuste o tamanho conforme necessário */
        border-radius: 50%;
        /* Isso tornará o fundo redondo */
        text-align: center;
        line-height: 20px;
        /* Centraliza o texto verticalmente */
    }
</style>

{% endblock %}

{% block containerFluid %}

<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Apontamento montagem</h1>
    </div>

    <div class="row">

        <!-- tabela iniciar apontamento -->
        <div class="col-xl-12 mb-2">
            <div class="card shadow mb-4">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div class="row mb-2">
                            <div class="col mb-2"><button id="filterChassi" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'CHASSI')">CHASSI</button></div>
                            <div class="col mb-2"><button id="filterEixoCompleto" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'EIXO COMPLETO')">EIXO COMPLETO</button></div>
                            <div class="col mb-2"><button id="filterEixoSimples" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'EIXO SIMPLES')">EIXO
                                    SIMPLES</button></div>
                            <div class="col mb-2"><button id="filterConjInterm" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'CONJ INTERMED')">CONJ INTERMED</button></div>
                            <div class="col mb-2"><button id="filterEstamparia" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'ESTAMPARIA')">ESTAMPARIA</button></div>
                            <div class="col mb-2"><button id="filterCilindro" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'CILINDRO')">CILINDRO</button></div>
                            <div class="col mb-2"><button id="filterPlat" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'PLAT. TANQUE. CAÇAM.')">PLAT. TANQUE.
                                    CAÇAM.</button>
                            </div>
                            <div class="col mb-2"><button id="filterFueiro" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'FUEIRO')">FUEIRO</button></div>
                            <div class="col mb-2"><button id="filterIcamento" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'IÇAMENTO')">IÇAMENTO</button></div>
                            <div class="col mb-2"><button id="filterCuboDeRoda" type="button"
                                    class="btn btn-outline-secondary" style="width: 149px; height: 62px;"
                                    onclick="applyCelulaFilter(this, 'CUBO DE RODA')">CUBO
                                    DE RODA</button></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="dataCarga">Data da carga</label>
                                    <input type="date" id="dataCarga" class="form-control" data-column="0">
                                </div>
                            </div>
                            <div class="col-sm" style="display: none;">
                                <div class="form-group">
                                    <label for="celula">Célula</label>
                                    <div class="position-relative">
                                        <!-- <input type="text" class="form-control" id="cor" onclick="mostrarLista()" onblur="ocultarLista()"> -->
                                        <input id="celula" class="form-control" data-column="2" style="width: 250px;">
                                        <span id="clear-lista-celula" class="clear-icon-operador">x</span>
                                        <ul id="listaCelulas" class="custom-dropdown-menu">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Iniciar Processo</h6>
                    <button id="btnModalPecaFora" type="button" class="btn btn-info" data-toggle="modal"
                        data-target="#modalPecaFora">Peça
                        fora planejamento</button>
                </div>
                <br>
                <!-- Card Body -->
                <div class="card-body">
                    <div id="no-more-tables">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable">
                                <thead class="cf">
                                    <tr>
                                        <th>Data da carga</th>
                                        <th>Data planejada</th>
                                        <th style="display: none;">Célula</th>
                                        <th>Código</th>
                                        <th>Descrição</th>
                                        <th>Qt. planejada</th>
                                        <th>Iniciar</th>
                                        <th style="display: none;">codificacao</th>
                                        <th style="display: none;">id</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if sheet_data %}
                                    {% for data in sheet_data %}
                                    <tr>
                                        <td data-title="Data da carga">{{ data[0] }}</td>
                                        <td data-title="Data planejada">{{ data[1] }}</td>
                                        <td data-title="Célula" style="display: none;">{{ data[2] }}</td>
                                        <td data-title="Código">{{ data[3] }}</td>
                                        <td data-title="Descrição">{{ data[4] }}</td>
                                        <td data-title="Qt. planejada">{{ data[5] }}</td>
                                        <td data-title="Iniciar"><button id="btnIniciarProducao" type="button"
                                                class="btn btn-info" data-toggle="modal"
                                                data-target="#modalConfirmarInicioProducao">Iniciar</button>
                                        </td>
                                        <td data-title="codificacao" style="display: none;">{{ data[7] }}</td>
                                        <td data-title="id" style="display: none;">{{ data[8] }}</td>
                                    </tr>
                                    {% endfor %}

                                    {% else %}
                                    <tr>
                                        <td colspan="7">Nenhum dado disponível</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="row">

        <div class="col-xl-6 mb-2">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Peças em processo</h6>
                </div>
                <div class="card-body" style="max-height: 700px; overflow-y: auto;">
                    <div class="row" id="cardsContainer">
                        <!-- Aqui serão inseridos os cards dinamicamente com JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6 mb-2">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Peças interrompidas</h6>
                </div>
                <div class="card-body" style="max-height: 700px; overflow-y: auto;">
                    <div class="row" id="cardsContainerInterrompida">
                        <!-- Aqui serão inseridos os cards dinamicamente com JavaScript -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal peça fora do sequenciamento -->
    <div class="modal fade" id="modalPecaFora" tabindex="-1" role="dialog" aria-labelledby="modalPecaForaLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalPecaForaLabel">Gerar apontamento para peça fora do
                        sequenciamento</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="form-floating mb-3">
                                <label for="userInput">Peça</label>
                                <div class="position-relative">
                                    <input class="form-control" type="text" id="userInput"
                                        oninput="showSuggestionsPecas()">
                                    <span id="peca-modal" class="clear-icon-operador">x</span>
                                    <ul id="suggestionsPecas" class="custom-dropdown-menu"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="form-floating mb-3">
                                <label for="inputData">Data da carga</label>
                                <input class="form-control" type="date" id="inputData"> <!-- Data da carga -->
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="form-floating mb-3">
                                <label for="inputQuantidade">Quantidade</label>
                                <input class="form-control" type="number" id="inputQuantidade">
                                <!-- Quantidade -->
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-12 mb-2">
                            <label for="celulaModalForaSequenciamento">Célula</label>
                            <div class="position-relative">
                                <select class="form-control" id="celulaModalForaSequenciamento">
                                    <option></option>
                                    <option>LATERAL</option>
                                    <option>EIXO COMPLETO</option>
                                    <option>EIXO SIMPLES</option>
                                    <option>CONJ INTERMED</option>
                                    <option>ESTAMPARIA</option>
                                    <option>CILINDRO</option>
                                    <option>PLAT. TANQUE. CAÇAM.</option>
                                    <option>CHASSI</option>
                                    <option>FUEIRO</option>
                                    <option>IÇAMENTO</option>
                                    <option>CUBO DE RODA</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label for="textAreaObservacao">Observação</label>
                            <textarea class="form-control" id='textAreaObservacao'></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btnSalvar" type="button" class="btn btn-primary">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal finalizar apontamento -->
    <div class="modal fade" id="modalExecucaoApontamento" tabindex="-1" role="dialog"
        aria-labelledby="modalExecucaoApontamentoLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExecucaoApontamentoLabel">Apontar peça</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row mb-2">
                        <div class="col-12 mb-2">
                            <div class="form-floating mb-3">
                                <label for="nomePecaApontada">Peça</label>
                                <input class="form-control" type="text" id="nomePecaApontada" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6 mb-2">
                            <div class="form-floating mb-3">
                                <label for="inputQuantidadePlanejada">Quantidade planejada</label>
                                <input class="form-control" type="number" id="inputQuantidadePlanejada" readonly>
                                <!-- Quantidade -->
                            </div>
                        </div>
                        <div class="col-6 mb-2">
                            <div class="form-floating mb-3">
                                <label for="inputQuantidadeRealizada">Quantidade realizada</label>
                                <input class="form-control" type="number" id="inputQuantidadeRealizada">
                                <!-- Quantidade -->
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6 mb-2">
                            <label for="operadorInputModal_1">Operador</label>
                            <div class="position-relative">
                                <input class="form-control" type="text" id="operadorInputModal_1"
                                    autocomplete="false" />
                                <span id="operador-modal-finalizar" class="clear-icon-operador">x</span>
                                <ul id="sugestaoOperadorModal_1" class="custom-dropdown-menu"></ul>
                            </div>
                        </div>
                        <div class="col-6 mb-2">
                            <div class="form-floating mb-3">
                                <label for="dataHoraInicio">Data e hora de início</label>
                                <input class="form-control" type="datetime-local" id="dataHoraInicio" readonly>
                                <!-- data e hora que iniciou e finalizou a ordem -->
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-12 mb-2">
                            <label for="textAreaObservacao_">Observação</label>
                            <textarea class="form-control" id="textAreaObservacao_"></textarea>
                        </div>
                    </div>
                    <div class="row mb-2" style="display: none;">
                        <div class="col-12 mb-2">
                            <label for="codificacaoOrdem">Código da ordem</label>
                            <input class="form-control" type="text" id="codificacaoOrdem" readonly>
                            <!-- codificação da ordem -->
                        </div>
                    </div>
                    <div class="row mb-2" style="display: none;">
                        <div class="col-12 mb-2">
                            <label for="celulaOrdem">Célula</label>
                            <input class="form-control" type="text" id="celulaOrdem" readonly>
                        </div>
                    </div>
                    <div class="row mb-2" style="display: none;">
                        <div class="col-12 mb-2">
                            <label for="dataCargaFinalizacao">Data Carga</label>
                            <input class="form-control" type="text" id="dataCargaFinalizacao" readonly>
                        </div>
                    </div>
                    <div class="row mb-2" style="display: none;">
                        <div class="col-12 mb-2">
                            <label for="idPecaEmProcesso">Id</label>
                            <input class="form-control" type="text" id="idPecaEmProcesso" readonly>
                        </div>
                    </div>
                    <div class="row mb-2" style="display: none;">
                        <div class="col-12 mb-2">
                            <label for="origemPecaEmProcesso">Origem</label>
                            <input class="form-control" type="text" id="origemPecaEmProcesso" readonly>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btnFinalizarOrdem" type="button" class="btn btn-primary">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal confirmar inicio -->
    <div class="modal fade" id="modalConfirmarInicioProducao" tabindex="-1" role="dialog"
        aria-labelledby="modalConfirmarInicioProducaoLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalConfirmarInicioProducaoLabel">Iniciar</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="labelConfirmar">Confirmar início da produção?</p>
                    <p id="pecaTextoModalIniciar"></p>
                    <input id="retornarPecaProducao" style="display: none;">
                </div>
                <div class="modal-footer">
                    <button id="confimarInicioProducao" type="button" class="btn btn-success">Sim</button>
                    <button id="confimarRetornoProducao" type="button" class="btn btn-success">Sim</button>
                    <button id="desistirInicioProducao" type="button" class="btn btn-danger">Não</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal motivo de interrompido -->
    <div class="modal fade" id="modalMotivoInterrompido" tabindex="-1" role="dialog"
        aria-labelledby="modalMotivoInterrompidoLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalMotivoInterrompidoLabel">Escolha o motivo da parada</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="idPecaInterromper" style="display: none;">
                    <select class="form-control" name="motivosParada" id="idMotivosParada">
                        <option>Manutenção</option>
                        <option>Limpeza</option>
                        <option>Falta de peça</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button id="enviarMotivo" type="button" class="btn btn-success">Enviar</button>
                    <button id="desistirMotivo" type="button" class="btn btn-danger">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <div id="alertBox" class="alert alert-danger">
        <strong>Erro!</strong> Preencha todos os campos.
    </div>

    <div id="successAlert" class="alert alert-success" role="alert">
        Salvo!
    </div>

    {% endblock %}

    {% block scripts %}

    <!-- Script tabela JQuery -->

    <script src="static/vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="static/vendor/datatables/dataTables.bootstrap4.min.js"></script>
    <script src="static/js/demo/datatables-demo.js"></script>

    <!-- Scripts campos de filtro -->

    <script>
        $(document).ready(function () {
            // Obtém a data de hoje no formato 'YYYY-MM-DD'
            var today = moment().format('DD/MM/YYYY');

            // Define o valor padrão para o campo de data
            $('#dataCarga').val(today);
            // Restante do seu código...
        });

        $('#dataTable').dataTable({
            lengthMenu: [
                [10, 25, 50, -1],
                [10, 25, 50, 'All']
            ]
        });

    </script>

    <script>
        $(document).ready(function () {

            var table = $('#dataTable').DataTable();

            var table_width = document.getElementById('dataTable');

            // Remove o atributo "style" que contém o width
            table_width.style.removeProperty('width');

            // Função para obter valores únicos de uma coluna
            function getUniqueColumnValues(columnIndex) {
                return table.column(columnIndex, { search: 'applied' }).data().unique().sort().toArray();
            }

            // Função para popular as opções de um datalist
            // function populateDatalistOptions(inputId, datalistId, columnIndex) {
            //     var ulList = $('#' + datalistId);
            //     ulList.empty(); // Limpa as opções existentes

            //     var uniqueValues = getUniqueColumnValues(columnIndex);

            //     // Adiciona as opções à lista
            //     uniqueValues.forEach(function (value) {
            //         ulList.append('<li value="' + value + '">' + value + '</li>');
            //     });

            //     // Adiciona manipulador de eventos para os itens da lista
            //     ulList.on('click', 'li', function () {
            //         var selectedValue = $(this).attr('value');
            //         $('#' + inputId).val(selectedValue); // Preenche o input com o valor selecionado
            //         ulList.hide(); // Oculta a lista após a seleção
            //         console.log(selectedValue);
            //         applyCelulaFilter(selectedValue);
            //     });
            //     console.log(uniqueValues);
            // }

            // Função para exibir a lista ao clicar no input
            function showListOnInputClick(inputId, datalistId, columnIndex) {
                $('#' + inputId).on('click', function () {
                    $('#' + datalistId).show(); // Exibe a lista ao receber clicar
                    populateDatalistOptions(inputId, datalistId, columnIndex);
                });

                $('#' + inputId).on('blur', function () {
                    // Adicione alguma lógica de ocultar a lista se necessário
                    setTimeout(function () {
                        $('#' + datalistId).hide(); // Oculta a lista após um pequeno atraso
                    }, 100);
                });
            }

            // Função para aplicar o filtro com base na data
            function applyDateFilter() {
                var columnIndex = $('#dataCarga').data('column');
                var filterValue = $('#dataCarga').val();

                // Formata a data usando Moment.js
                if (filterValue === '') {
                    filterValue = moment().format('DD/MM/YYYY');
                } else {
                    filterValue = moment(filterValue, 'YYYY-MM-DD').format('DD/MM/YYYY');
                }

                // Define o filtro na coluna específica
                table.column(columnIndex).search(filterValue).draw();

                // populateDatalistOptions('celula', 'listaCelulas', 2);
            }

            function applyColorFilter() {
                var columnIndex = $('#celula').data('column');
                var filterValue = $('#celula').val();

                console.log('Column Index:', columnIndex);
                console.log('Filter Value:', filterValue);

                // Define o filtro na coluna específica
                table.column(columnIndex).search(filterValue).draw();
            }

            function applyCelulaFilter(selectedValue) {

                var columnIndex = $('#celula').data('column');

                // Define o filtro na coluna específica
                table.column(columnIndex).search(selectedValue).draw();
            }

            // Carrega as opções do datalist quando a página é carregada
            // populateDatalistOptions('celula', 'listaCelulas', 2);
            showListOnInputClick('celula', 'listaCelulas', 2);

            // Aplica o filtro ao carregar a página
            applyDateFilter();

            // Adiciona campos de entrada para filtrar por coluna
            $('#dataCarga').on('input', function () {
                applyDateFilter();
            });

            $('#celula').on('input', function () {
                applyColorFilter();
            });

            function limparCampoCelula() {
                $('#celula').val('');
                applyCelulaFilter('');
            }

            // Adiciona o evento de clique ao ícone "x" para limpar o campo 'celula'
            $('#clear-lista-celula').on('click', function () {
                limparCampoCelula();
            });

        });
    </script>

    <script>
        var table = $('#dataTable').DataTable();

        // Variável para armazenar o estado do filtro
        var filterActive = false;

        function applyCelulaFilter(button, selectedValue) {
            var columnIndex = $('#celula').data('column');


            // Se o filtro estiver ativo e o valor do botão for o mesmo que o filtro atual, desative o filtro
            if (filterActive && $(button).hasClass('active')) {
                table.column(columnIndex).search('').draw();
                $(button).removeClass('active'); // Remova a classe active do botão
                filterActive = false; // Marque o filtro como inativo
                $('#celula').val('');
                $('.btn').removeClass('active');
            } else {
                // Defina o filtro na coluna específica
                $('.btn').removeClass('active');
                table.column(columnIndex).search(selectedValue).draw();
                $(button).addClass('active'); // Adicione a classe active ao botão
                filterActive = true; // Marque o filtro como ativo
                $('#celula').val(selectedValue);
            }
        }
    </script>

    <!-- Script botão de enviar -->

    <script>
        $(document).ready(function () {
            // Adicione um manipulador de clique ao botão de envio
            $('#enviarBtn').on('click', function () {
                // Obtém as linhas com a coluna 5 diferente de vazio
                showLoading();
                var linhas = [];
                $('#dataTable tbody tr').each(function () {
                    var qt_produzida = $(this).find('td:eq(5) input').val(); // Obtém o valor da coluna 5
                    console.log(qt_produzida);
                    if (qt_produzida !== '') {
                        // Obtém os valores das outras colunas se necessário
                        var data = $(this).find('td:eq(0)').text().trim();
                        var celula = $(this).find('td:eq(1)').text().trim();
                        var codigo = $(this).find('td:eq(2)').text().trim();
                        var descricao = $(this).find('td:eq(3)').text().trim();
                        // var operador = $(this).find('td:eq(6) input').val();
                        // var obs = $(this).find('td:eq(7) textarea').val();
                        // var codificacao = $(this).find('td:eq(8)').text().trim();

                        // Adiciona os dados da linha ao array
                        linhas.push({
                            data: data, celula: celula, codigo: codigo, descricao: descricao//, prod: qt_produzida,
                            // operador: operador, obs: obs, codificacao: codificacao
                        });

                        console.log(linhas);
                    }
                    else {
                        return;
                    }
                });

                // Envia os dados para o backend
                $.ajax({
                    type: 'POST',
                    url: '/salvar-apontamento-montagem',
                    contentType: 'application/json',  // Define o tipo de conteúdo como JSON
                    data: JSON.stringify({ linhas: linhas }),
                    success: function (data) {
                        console.log('Solicitação POST bem-sucedida:', data);
                        hideLoading();
                        showAndHideSuccessAlert('Salvo.', 2000);
                        location.reload();
                    },
                    error: function (error) {
                        console.error('Erro na solicitação POST:', error);
                        // Adiciona um pequeno atraso antes de chamar hideLoading()
                        hideLoading();
                        location.reload();
                    }
                });
            });
        });

    </script>

    <!-- Script tratar data -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <!-- Script tela de carregamento -->

    <script>
        function showLoading() {
            $('#loading').show();
        }

        function hideLoading() {
            $('#loading').hide();
        }
    </script>

    <!-- Script para enviar informações de peça fora do sequenciamento para o backend -->

    <script>
        $(document).ready(function () {
            $('#btnSalvar').on('click', function () {
                showLoading();
                // Coletar dados do formulário
                const peca = $('#userInput').val();
                const dataCarga = $('#inputData').val();
                const quantidade = $('#inputQuantidade').val();
                const operador = $('#operadorInputModal').val();
                const obs = $('#textAreaObservacao').val();
                const celulaModalForaSequenciamento = $('#celulaModalForaSequenciamento option:selected').text();

                if (peca === '' || dataCarga === '' || quantidade === '' || celulaModalForaSequenciamento === '') {
                    $('.alert').alert()
                    hideLoading();
                    showAndHideAlert('Preencha todos os campos.', 2000);
                    return;
                }

                // Criar objeto com os dados
                const dados = {
                    peca: peca.split(' - ')[0],
                    descricao: peca.split(' - ')[1],
                    dataCarga: dataCarga,
                    qtPlanejada: quantidade,
                    codificacao: '',
                    celula: celulaModalForaSequenciamento,
                    chave: '',
                    origem: 'Fora do sequenciamento'
                };

                // Enviar dados para o backend
                $.ajax({
                    url: '/api/pecas-em-processo/montagem',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(dados),
                    success: function (response) {
                        // Tratar a resposta do backend, se necessário
                        console.log(response);
                        hideLoading();
                        showAndHideSuccessAlert('Salvo.', 2000);
                        $('#modalPecaFora').modal('hide');
                    },
                    error: function (err) {
                        console.error('Erro ao enviar dados para o backend', err);
                        hideLoading();
                    }
                });
            });
        });
    </script>

    <!-- Script de alertas (Depois jogar em um arquivo.js) -->

    <script>
        function showAndHideAlert(message, duration) {
            const alertBox = $('#alertBox');
            alertBox.html(`<strong>Danger!</strong> ${message}`);
            alertBox.slideDown();

            setTimeout(function () {
                alertBox.slideUp();
            }, duration);
        }

    </script>

    <script>
        function showAndHideSuccessAlert(message, duration) {
            const successAlert = $('#successAlert');
            successAlert.html(message);
            successAlert.slideDown();

            setTimeout(function () {
                successAlert.slideUp();
            }, duration);
        }
    </script>

    <!-- Script para lista input peças dentro do modal -->

    <script>

        // Função para ocultar a lista
        function hideSuggestionsPecas() {
            $('#suggestionsPecas').css('display', 'none');
        }

        // Adicionar um event listener para cliques no documento
        $(document).on('click', function (event) {
            const clickedElement = $(event.target);

            // Verificar se o clique foi fora da lista e do campo de entrada
            if (!clickedElement.closest('#suggestionsPecas, #userInput').length) {
                hideSuggestionsPecas();
            }
        });

        // Adicionar um event listener para o input para ocultar a lista quando estiver vazio
        $('#userInput').on('input', function () {
            const userInput = $(this).val().trim();

            if (!userInput.length) {
                hideSuggestionsPecas();
            }
        });

        $('#userInput').on('click', function () {
            showSuggestionsPecas();
        });

        // Variável para armazenar os dados brutos do backend
        let suggestionsDataPecaModal = [];

        // Função para obter dados brutos do backend
        function fetchSuggestionsDataTeste() {
            $.ajax({
                url: '/sugestao-pecas-montagem',
                method: 'GET',
                success: function (data) {
                    suggestionsDataPecaModal = data.map(row => row[Object.keys(row)[0]]);
                    console.log('Dados brutos do Backend modal:', suggestionsDataPecaModal);
                },
                error: function (err) {
                    console.error('Erro ao obter dados brutos do backend', err);
                }
            });
        }

        // Chamar a função de obter dados brutos assim que a página carregar
        $(document).ready(function () {
            fetchSuggestionsDataTeste();
        });

        // Função para exibir sugestões filtradas
        function showSuggestionsPecas() {
            const userInput = document.getElementById('userInput').value.toLowerCase();

            console.log('User Input:', userInput);

            // Limpar sugestões anteriores
            $('#suggestionsPecas').empty();

            // Filtrar sugestões com base no texto inserido pelo usuário
            const filteredSuggestions = suggestionsDataPecaModal.filter(suggestion =>
                suggestion.toLowerCase().includes(userInput)
            );

            console.log('Sugestões Filtradas:', filteredSuggestions);

            // Exibir sugestões filtradas na lista
            filteredSuggestions.forEach(suggestion => {
                const li = $('<li>');
                const a = $('<a>').attr('href', '#').text(suggestion);
                a.on('click', function (event) {
                    event.preventDefault();
                    // Ação ao selecionar uma sugestão (pode ser ajustada conforme necessário)
                    $('#userInput').val(suggestion);
                    hideSuggestionsPecas();
                });
                li.append(a);
                $('#suggestionsPecas').append(li);
            });

            // Exibir a lista se houver sugestões filtradas, ocultar caso contrário
            $('#suggestionsPecas').css('display', filteredSuggestions.length ? 'block' : 'none');
        }

        function limparCampoPecaModal() {
            $('#userInput').val('');
        }

        // Adiciona o evento de clique ao ícone "x" para limpar o campo 'celula'
        $('#peca-modal').on('click', function () {
            limparCampoPecaModal();
        });

    </script>

    <!-- Script para lista de operadores -->

    <script>

        function hideSuggestions() {
            $('.suggestions-operadores').css('display', 'none');
        }

        $(document).on('click', function (event) {
            const clickedElement = $(event.target);

            if (!clickedElement.closest('.suggestions-operadores, .operador-input').length) {
                hideSuggestions();
            }
        });

        $('.operador-input').on('input', function () {
            const operadorInput = $(this).val().trim();

            if (!operadorInput.length) {
                hideSuggestions();
            }
        });

        $('.operador-input').on('click', function () {
            showSuggestionsOperadores(this);
        });

        let suggestionsData1 = [];

        function fetchSuggestionsData() {
            $.ajax({
                url: '/sugestao-operadores-montagem',
                method: 'GET',
                success: function (data) {
                    suggestionsData1 = data.map(row => row[Object.keys(row)[0]]);
                    console.log('Dados brutos do Backend:', suggestionsData1);
                },
                error: function (err) {
                    console.error('Erro ao obter dados brutos do backend', err);
                }
            });
        }

        $(document).ready(function () {
            fetchSuggestionsData();
        });

        function showSuggestionsOperadores(inputElement) {
            const suggestionsDropdown = $(inputElement).closest('td').find('.suggestions-operadores');
            const operadorInput = $(inputElement).val().toLowerCase();

            suggestionsDropdown.empty();

            const filteredSuggestions = suggestionsData1.filter(suggestion =>
                suggestion.toLowerCase().includes(operadorInput)
            );

            filteredSuggestions.forEach(suggestion => {
                const li = $('<li>');
                const a = $('<a>').attr('href', '#').text(suggestion);
                a.on('click', function (event) {
                    event.preventDefault();
                    $(inputElement).val(suggestion);
                    hideSuggestions();
                });
                li.append(a);
                suggestionsDropdown.append(li);
            });

            suggestionsDropdown.css('display', filteredSuggestions.length ? 'block' : 'none');
        }

        $('.clear-icon-operador').on('click', function () {
            const inputElement = $(this).siblings('.operador-input');
            limparCampoOperador(inputElement);
        });

        function limparCampoOperador(inputElement) {
            $(inputElement).val('');
        }

    </script>

    <!-- Script para lista input operador dentro do modal -->

    <script>

        // Função para ocultar a lista
        function hideSuggestionsOperadorModal() {
            $('#sugestaoOperadorModal').css('display', 'none');
        }

        // Adicionar um event listener para cliques no documento
        $(document).on('click', function (event) {
            const clickedElement = $(event.target);

            // Verificar se o clique foi fora da lista e do campo de entrada
            if (!clickedElement.closest('#sugestaoOperadorModal, #operadorInputModal').length) {
                hideSuggestionsOperadorModal();
            }
        });

        // Adicionar um event listener para o input para ocultar a lista quando estiver vazio
        $('#operadorInputModal').on('input', function () {
            const operadorInputModal = $(this).val().trim();

            if (!operadorInputModal.length) {
                hideSuggestionsOperadorModal();
            }
        });

        $('#operadorInputModal').on('click', function () {
            showSuggestionsOperadorModal();
        });

        // Variável para armazenar os dados brutos do backend
        let suggestionsOperadorModal = [];

        // Função para obter dados brutos do backend
        function fetchSuggestionsOperadorModal() {
            $.ajax({
                url: '/sugestao-operadores-montagem',
                method: 'GET',
                success: function (data) {
                    suggestionsOperadorModal = data.map(row => row[Object.keys(row)[0]]);
                    console.log('Dados brutos do Backend modal:', suggestionsOperadorModal);
                },
                error: function (err) {
                    console.error('Erro ao obter dados brutos do backend', err);
                }
            });
        }

        // Chamar a função de obter dados brutos assim que a página carregar
        $(document).ready(function () {
            fetchSuggestionsOperadorModal();
        });

        // Função para exibir sugestões filtradas
        function showSuggestionsOperadorModal() {
            const operadorInputModal = document.getElementById('operadorInputModal').value.toLowerCase();

            console.log('User Input:', operadorInputModal);

            // Limpar sugestões anteriores
            $('#sugestaoOperadorModal').empty();

            // Filtrar sugestões com base no texto inserido pelo usuário
            const filteredSuggestions = suggestionsOperadorModal.filter(suggestion =>
                suggestion.toLowerCase().includes(operadorInputModal)
            );

            console.log('Sugestões Filtradas:', filteredSuggestions);

            // Exibir sugestões filtradas na lista
            filteredSuggestions.forEach(suggestion => {
                const li = $('<li>');
                const a = $('<a>').attr('href', '#').text(suggestion);
                a.on('click', function (event) {
                    event.preventDefault();
                    // Ação ao selecionar uma sugestão (pode ser ajustada conforme necessário)
                    $('#operadorInputModal').val(suggestion);
                    hideSuggestionsOperadorModal();
                });
                li.append(a);
                $('#sugestaoOperadorModal').append(li);
            });

            // Exibir a lista se houver sugestões filtradas, ocultar caso contrário
            $('#sugestaoOperadorModal').css('display', filteredSuggestions.length ? 'block' : 'none');
        }

        function limparCampoOperadorModal() {
            $('#operadorInputModal').val('');
        }

        // Adiciona o evento de clique ao ícone "x" para limpar o campo 'celula'
        $('#operador-modal').on('click', function () {
            limparCampoOperadorModal();
        });

    </script>

    <!-- Script para lista input operador dentro do modal de finalizar -->

    <script>
        // Função para obter dados brutos do backend
        function fetchSuggestionsOperadorModal() {
            $.ajax({
                url: '/sugestao-operadores-montagem',
                method: 'GET',
                success: function (data) {
                    suggestionsOperadorModal = data.map(row => row[Object.keys(row)[0]]);
                    console.log('Dados brutos do Backend modal:', suggestionsOperadorModal);

                    // Adicione código aqui para exibir as sugestões na lista
                    updateSuggestionsList(suggestionsOperadorModal);
                },
                error: function (err) {
                    console.error('Erro ao obter dados brutos do backend', err);
                }
            });
        }

        // Função para atualizar a lista de sugestões
        function updateSuggestionsList(suggestions) {
            var sugestoesLista = $('#sugestaoOperadorModal_1');
            sugestoesLista.empty(); // Limpa a lista antes de adicionar novas sugestões

            suggestions.forEach(function (sugestao) {
                sugestoesLista.append('<li>' + sugestao + '</li>');
            });
        }

        // Adiciona um evento de clique ao input
        $('#operadorInputModal_1').click(function () {
            // Chama a função para obter sugestões e exibi-las
            fetchSuggestionsOperadorModal();

            // Adicione aqui o código para exibir a lista de sugestões
            // Por exemplo, você pode mostrar ou esconder a lista usando CSS ou jQuery.
            $('#sugestaoOperadorModal_1').show();
        });

        // Adiciona um manipulador de eventos ao clique nos itens da lista
        $('#sugestaoOperadorModal_1').on('click', 'li', function () {
            // Pega o texto do item clicado
            var sugestaoSelecionada = $(this).text();

            // Define o valor do input como a sugestão selecionada
            $('#operadorInputModal_1').val(sugestaoSelecionada);

            // Esconde a lista de sugestões após selecionar uma
            $('#sugestaoOperadorModal_1').hide();
        });

        // Adiciona um evento de digitação ao input para filtrar a lista
        $('#operadorInputModal_1').on('input', function () {
            var textoDigitado = $(this).val().toLowerCase();
            var sugestoesFiltradas = suggestionsOperadorModal.filter(function (sugestao) {
                return sugestao.toLowerCase().includes(textoDigitado);
            });

            // Atualiza a lista de sugestões com base no texto digitado
            updateSuggestionsList(sugestoesFiltradas);

            // Mostra a lista de sugestões após filtrar
            $('#sugestaoOperadorModal_1').show();
        });

        // Adiciona um manipulador de eventos de clique ao documento para esconder a lista ao clicar fora
        $(document).on('click', function (event) {
            var target = $(event.target);

            // Verifica se o clique não foi no input e nem na lista de sugestões
            if (!target.is('#operadorInputModal_1') && !target.closest('#sugestaoOperadorModal_1').length) {
                // Esconde a lista de sugestões
                $('#sugestaoOperadorModal_1').hide();
            }
        });
    </script>

    <!-- Script para confirmar inicio da produção -->

    <script>
        $(document).on('click', '#btnIniciarProducao', function () {
            // Obter os dados da linha da tabela
            var rowData = $(this).closest('tr').find('td').map(function () {
                return $(this).text();
            }).get();

            var botaoRetornar = document.getElementById('confimarRetornoProducao');
            botaoRetornar.style.display = 'none';

            var botaoIniciar = document.getElementById('confimarInicioProducao');
            botaoIniciar.style.display = 'block';

            document.getElementById('pecaTextoModalIniciar').textContent = (rowData[2] + " - " + rowData[3]);

            // Associar o evento de clique ao botão #confimarInicioProducao dentro do evento de clique do botão #btnIniciarProducao
            $('#confimarInicioProducao').off('click').on('click', function () {

                // Criar objeto com os dados
                const dados = {
                    peca: rowData[3],
                    descricao: rowData[4],
                    dataCarga: rowData[0],
                    celula: rowData[2],
                    qtPlanejada: rowData[5],
                    codificacao: rowData[7],
                    chave: rowData[8],
                    origem: 'Sequenciamento'
                };

                showLoading();

                $.ajax({
                    url: '/api/pecas-em-processo/montagem',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(dados),
                    success: function (response) {
                        // Tratar a resposta do backend, se necessário
                        console.log(response);
                        hideLoading();
                        showAndHideSuccessAlert('Salvo.', 2000);
                        $('#modalConfirmarInicioProducao').modal('hide');
                    },
                    error: function (err) {
                        console.error('Erro ao enviar dados para o backend', err);

                        hideLoading();
                    }
                });
            });

        });

        // Associar o evento de clique ao botão #desistirInicioProducao
        $('#desistirInicioProducao').on('click', function () {
            // Fechar o modal após a confirmação (opcional)
            $('#modalConfirmarInicioProducao').modal('hide');
        });
    </script>

    <!-- Script para iniciar ou finalizar produção e listar peças em processo -->

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            function chamarAPI() {
                fetch("/api/consulta-pecas-em-processo/montagem")
                    .then(response => response.json())
                    .then(data => {
                        // Limpa o conteúdo atual dos cards
                        document.getElementById('cardsContainer').innerHTML = "";

                        var celulaEscolhida = document.getElementById('celula').value;

                        if (celulaEscolhida === '') {
                            // Se a célula escolhida estiver vazia, não há necessidade de filtrar os dados
                            // Você pode passar os dados diretamente para o forEach
                            processarDados(data);
                        } else {
                            // Filtra os dados com base na célula escolhida
                            const dadosFiltrados = data.filter(peca => peca[8] === celulaEscolhida);
                            // Processa os dados filtrados
                            processarDados(dadosFiltrados);
                        }
                    })
                    .catch(error => console.error('Erro ao chamar a API:', error));
            }

            function processarDados(data) {
                data.forEach(peca => {
                    // Aqui você pode continuar com o processamento dos dados e a criação dos cards
                    var cardHtml = `
                                <div class="col-sm-6 mb-2">
                                    <div class="card shadow mb-4">
                                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                            <h6 class="m-0 font-weight-bold text-secondary"><small>${peca[1] + " - " + peca[2]}</small></h6>
                                            <span id="contador-${peca[0]}" class="badge badge-primary badge-pill"></span>   
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <h6 class="m-0 font-weight-bold text-primary"><small><strong>Célula:</strong> ${peca[8]}</small></h6>
                                                    <h6 class="m-0 font-weight-bold text-primary"><small><strong>Qt. Planejada:</strong> ${peca[7]}</small></h6>
                                                </div>
                                                <div class="col-sm-6">
                                                    <h6 class="m-0 font-weight-bold text-primary"><small><strong>Origem:</strong> ${peca[13]}</small></h6>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <button type="button" class="btn btn-info btn-finalizar-producao"
                                                onclick="finalizarPeca(${peca[0]})">Finalizar
                                            </button>
                                            <button type="button" class="btn btn-warning btn-interromper-producao"
                                                onclick="interromperProcesso(${peca[0]})">Interromper
                                            </button>
                                        </div>
                                    </div>
                                </div>`;
                    document.getElementById('cardsContainer').innerHTML += cardHtml;
                    // Atualiza o contador imediatamente ao carregar a página
                    const dataInicial = new Date(formatarData(peca[3]));
                    console.log(dataInicial);
                    atualizarContador(dataInicial, peca[0]);
                });
            }

            function chamarAPIInterrompidas() {
                fetch("/api/consulta-pecas-interrompidas/montagem")
                    .then(response => response.json())
                    .then(data => {
                        // Limpa o conteúdo atual dos cards
                        document.getElementById('cardsContainerInterrompida').innerHTML = "";

                        var celulaEscolhida = document.getElementById('celula').value;

                        if (celulaEscolhida === '') {
                            // Se a célula escolhida estiver vazia, não há necessidade de filtrar os dados
                            // Você pode passar os dados diretamente para o forEach
                            processarDadosInterrompida(data);
                        } else {
                            // Filtra os dados com base na célula escolhida
                            const dadosFiltrados = data.filter(peca => peca[8] === celulaEscolhida);
                            // Processa os dados filtrados
                            processarDadosInterrompida(dadosFiltrados);
                        }
                    })
                    .catch(error => console.error('Erro ao chamar a API:', error));
            }

            function processarDadosInterrompida(data) {
                data.forEach(peca => {
                    var cardHtml = `
                    <div class="col-sm-6 mb-2">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-secondary"><small>${peca[1] + " - " + peca[2]}</small></h6>
                                <span id="contador-${peca[0]}" class="badge badge-primary badge-pill"></span>   
                            </div>
                            <div class="card-body">
                                <h6 class="m-0 font-weight-bold text-primary"><small><strong>Célula:</strong> ${peca[8]}</small></h6>
                                <h6 class="m-0 font-weight-bold text-primary"><small><strong>Qt. Planejada:</strong> ${peca[7]}</small></h6>
                                <h6 class="m-0 font-weight-bold text-primary"><small><strong>Motivo:</strong> ${peca[12]}</small></h6>
                            </div>
                            <div class="card-footer">
                                <button type="button" class="btn btn-info btn-retornar-producao"
                                    onclick="retornarPeca(${peca[0]})">Retornar
                                </button>
                            </div>
                        </div>
                    </div>`;

                    document.getElementById('cardsContainerInterrompida').innerHTML += cardHtml;

                    // Atualiza o contador imediatamente ao carregar a página
                    const dataInicial = new Date(formatarData(peca[3]));
                    atualizarContador(dataInicial, peca[0]);
                });
            }

            // Chama a API imediatamente ao carregar a página
            chamarAPI();
            chamarAPIInterrompidas();

            

            // Chama a API a cada segundo
            setInterval(atualizarContador, 1000);
            // setInterval(chamarAPIInterrompidas, 1000);
        });

        function formatarData(dataString) {
            var data = new Date(dataString);
            return data.toISOString().slice(0, 19);
        }

        // Função para finalizar a peça e mostrar informações
        function finalizarPeca(id) {
            // Exemplo: Mostrar informações em um alerta

            showLoading();

            var dados = {
                id_peca: id  // Substitua pelos dados reais que você deseja enviar
            };

            $.ajax({
                url: '/consulta-id-em-processo',
                method: 'GET',
                contentType: 'application/json',
                data: $.param(dados),
                success: function (data) {
                    console.log(data);
                    $('#nomePecaApontada').val(data[0][1] + " - " + data[0][2]);
                    $('#inputQuantidadePlanejada').val(data[0][7]);
                    $('#dataHoraInicio').val(formatarData(data[0][3]));
                    $('#codificacaoOrdem').val(data[0][4]);
                    $('#celulaOrdem').val(data[0][8]);
                    $('#dataCargaFinalizacao').val(data[0][5]);
                    $('#idPecaEmProcesso').val(data[0][0]);
                    $('#origemPecaEmProcesso').val(data[0][13]);

                    $('#inputQuantidadeRealizada').val();
                    $('#textAreaObservacao_').val();
                    $('#operadorInputModal_1').val();

                    hideLoading();
                    $('#modalExecucaoApontamento').modal('show');

                },
                error: function (err) {
                    console.error('Erro:', err);
                    hideLoading();
                }
            });

            // Aqui você pode adicionar lógica adicional conforme necessário
        }

        function atualizarContador(dataInicial, id_peca) {

            

            const agora = new Date();
            const diferenca = agora.getTime() - dataInicial.getTime();

            const segundos = Math.floor(diferenca / 1000);
            const minutos = Math.floor(segundos / 60);
            const horas = Math.floor(minutos / 60);
            const dias = Math.floor(horas / 24); // Calcula o número de dias

            const segundosRestantes = segundos % 60;
            const minutosRestantes = minutos % 60;
            const horasRestantes = horas % 24;

            const formatoTempo = `${dias.toString().padStart(2, '0')} : ${horasRestantes.toString().padStart(2, '0')} : ${minutosRestantes.toString().padStart(2, '0')} : ${segundosRestantes.toString().padStart(2, '0')}`;

            document.getElementById("contador-" + id_peca).textContent = formatoTempo;
        }

    </script>

    <!-- Script para finalizar a produção -->

    <script>
        $(document).ready(function () {
            $('#btnFinalizarOrdem').on('click', function () {

                pecaFinalizada = $('#nomePecaApontada').val();
                quantidadePlanejada = $('#inputQuantidadePlanejada').val();
                codificacao = $('#codificacaoOrdem').val();
                celula = $('#celulaOrdem').val();
                textAreaObservacao = $('#textAreaObservacao_').val();
                dataHoraInicio = $('#dataHoraInicio').val();
                operadorInputModal_1 = $('#operadorInputModal_1').val();
                inputQuantidadeRealizada = $('#inputQuantidadeRealizada').val();
                dataCarga = $('#dataCargaFinalizacao').val();
                idPecaEmProcesso = $('#idPecaEmProcesso').val();
                origem = $('#origemPecaEmProcesso').val();

                dados = {
                    codigo: pecaFinalizada,
                    qtdePlanejada: quantidadePlanejada,
                    codificacao: codificacao,
                    celula: celula,
                    textAreaObservacao: textAreaObservacao,
                    dataHoraInicio: dataHoraInicio,
                    operadorInputModal_1: operadorInputModal_1,
                    inputQuantidadeRealizada: inputQuantidadeRealizada,
                    dataCarga: formatarData(dataCarga),
                    idPecaEmProcesso: idPecaEmProcesso,
                    origem: origem
                }

                if (inputQuantidadeRealizada === '') {
                    showAndHideAlert('Por favor informe a quantidade.', 2000);
                    return;
                };

                if (operadorInputModal_1 === '') {
                    showAndHideAlert('Por favor informar o operador.', 2000);
                    return;
                }

                showAndHideSuccessAlert('Enviado!', 2000);
                $('#modalExecucaoApontamento').modal('hide');

                $.ajax({
                    type: 'POST',
                    url: '/finalizar-peca-em-processo',
                    contentType: 'application/json',  // Define o tipo de conteúdo como JSON
                    data: JSON.stringify(dados),
                    success: function (data) {
                        hideLoading();
                        showAndHideSuccessAlert('Salvo.', 2000);
                    },
                    error: function (error) {
                        console.error('Erro na solicitação POST:', error);
                        hideLoading();
                    }
                });
            });
        });

    </script>

    <!-- Script para interromper a ordem -->

    <script>

        function interromperProcesso(id) {

            $('#modalMotivoInterrompido').modal('show');

            $('#idPecaInterromper').val(id);

        }

        $(document).ready(function () {
            $('#enviarMotivo').on('click', function () {
                idPecaInterromper = $('#idPecaInterromper').val();
                motivoInterrompido = $('#idMotivosParada option:selected').text();

                showLoading();

                $.ajax({
                    type: 'POST',
                    url: '/api/pecas-interrompida/montagem',
                    contentType: 'application/json',  // Define o tipo de conteúdo como JSON
                    data: JSON.stringify({ id: idPecaInterromper, motivo: motivoInterrompido }),
                    success: function (data) {
                        hideLoading();
                        showAndHideSuccessAlert('Salvo.', 2000);
                        $('#modalMotivoInterrompido').modal('hide');
                    },
                    error: function (error) {
                        console.error('Erro na solicitação POST:', error);
                        hideLoading();
                        $('#modalMotivoInterrompido').modal('hide');
                    }
                });
            });

            $('#desistirMotivo').on('click', function () {
                $('#modalMotivoInterrompido').modal('hide');
            })
        });

    </script>

    <!-- Script para retornar a produção -->

    <script>

        function retornarPeca(id) {

            $('#modalConfirmarInicioProducao').modal('show');
            document.getElementById('modalConfirmarInicioProducaoLabel').textContent = 'Retorno'
            document.getElementById('pecaTextoModalIniciar').textContent = ''
            document.getElementById('labelConfirmar').textContent = 'Confirmar retorno para produção?'

            $('#retornarPecaProducao').val(id);

            var botaoRetornar = document.getElementById('confimarRetornoProducao');
            botaoRetornar.style.display = 'block';

            var botaoIniciar = document.getElementById('confimarInicioProducao');
            botaoIniciar.style.display = 'none';

        }

        $(document).ready(function () {
            $('#confimarRetornoProducao').on('click', function () {
                idPecaRetornar = $('#retornarPecaProducao').val();
                console.log(idPecaRetornar);

                showLoading();

                $.ajax({
                    type: 'POST',
                    url: '/api/pecas-retornou/montagem',
                    contentType: 'application/json',  // Define o tipo de conteúdo como JSON
                    data: JSON.stringify({ id: idPecaRetornar }),
                    success: function (data) {
                        hideLoading();
                        showAndHideSuccessAlert('Salvo.', 2000);
                        $('#modalConfirmarInicioProducao').modal('hide');
                    },
                    error: function (error) {
                        console.error('Erro na solicitação POST:', error);
                        hideLoading();
                        $('#modalConfirmarInicioProducao').modal('hide');
                    }
                });
            });
        });


        $(document).ready(function () {
            $('#desistirInicioProducao').on('click', function () {
                $('#modalConfirmarInicioProducao').modal('hide');
            })
        })

    </script>

    <!-- Script para apagar funcionario do modal de finalizar -->

    <script>
        function limparCampoOperadorModal_finalizar() {
            $('#operadorInputModal_1').val('');
        }

        // Adiciona o evento de clique ao ícone "x" para limpar o campo 'celula'
        $('#operador-modal-finalizar').on('click', function () {
            limparCampoOperadorModal_finalizar();
        });
    </script>

    {% endblock %}